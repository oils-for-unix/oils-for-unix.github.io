  <!DOCTYPE html>
  <html>
    <head>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Tasks Under NLNet Grant</title>
      <link rel="stylesheet" type="text/css" href="../web/base.css" />
    </head>
    <body class="width40">

<p><a href="Compiler-Engineer-Job.html">Compiler Engineer Job</a> describes the high level of what we're looking for.  It's about the mycpp translator, static types, and garbage collection.</p>
<p>But here is a more granular breakdown.</p>
<h2>Stages</h2>
<ol>
<li>Make more spec tests pass <strong>without</strong> the garbage collector.  This is valuable and still moves the project forward.  We want to get from the <strong>1496</strong> number up to <strong>1770</strong> that the Python version passes.
<ul>
<li>See <a href="https://www.oilshell.org/blog/2022/03/middle-out.html">Oil Is Being Implemented &quot;Middle Out&quot;</a>, particularly the plot of progress.</li>
</ul>
</li>
<li>Make <code>oil-native</code> translate with the new garbage collected runtime.
<ul>
<li>This will mean re-implementing OS bindings and data structures with the garbage collector's API.</li>
<li>I welcome feedback on the API.</li>
</ul>
</li>
</ol>
<h2>Tasks With No Dependencies</h2>
<ul>
<li><a href="Oil-Parser-Generator-Project.html">Oil Parser Generator Project</a></li>
</ul>
<h2>Work That Has Dependencies</h2>
<ul>
<li>Rewrite mycpp as &quot;Pea&quot;!  Using Python 3.10 pattern matching
<ul>
<li>I started doing this.  But I think I want to find someone to work on this first, and then let <strong>them</strong> decide.  Do we want to keep going with mycpp, or do we want to clean it up a bit?</li>
</ul>
</li>
<li>Implement a fast GC'd dictionary data structure in C++.   (We have something slow and workable now.)</li>
<li>Optimize the code generated by mycpp.</li>
</ul>
<h2>TODO: Reorganize</h2>
<p>Off the top of my head, here's what is left on the tools and runtime:</p>
<ol>
<li>Generate GC field masks from user-defined classes, taking inheritance into account.  This is part of the <a href="$xref">mycpp</a> Python translator, which is written in Python.</li>
<li>ASDL field masks?</li>
<li>Write a proper O(1) dictionary that actually uses hashing!  What we have now is more like an linear association list.
<ul>
<li>However we have to be careful that this is not a de-optimization.  Our benchmarks are not bad right now.  Most dicts are small, and N has to be surprisingly large before O(1) is faster O(N).</li>
</ul>
</li>
</ol>
<p>Here's what's left in general:</p>
<ol>
<li>Rewrite all the bindings for functions like <code>glob()</code> to use the garbage collector API!
<ul>
<li>Before starting this relatively big task, I could use some review of the API to make sure it's easy to use</li>
</ul>
</li>
<li>Figure out of the homogeneous parse tree ofr <a href="$xref">pgen2</a> should use garbage collected types or not.  I think not.</li>
<li>Make the Oil interpreter translatable, by making it statically typed.  (OSH is already completely statically typed.</li>
</ol>
  </body>
</html>

